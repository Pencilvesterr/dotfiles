#!/bin/bash
# Check for system dotfile changes that haven't been pulled back into this repo.
# This handles programs like htop that atomically replace their config files,
# which would otherwise break hardlinks silently.

if chezmoi status | grep -q .; then
  chezmoi re-add
  echo ""
  echo "  Changes detected in system dotfiles and pulled into this repo."
  echo "  Review the changes before committing:"
  echo ""
  echo "    git diff                  # see what changed"
  echo ""
  echo "  To keep the changes:"
  echo "    git add -u && git commit"
  echo ""
  echo "  To discard the changes:"
  echo "    chezmoi apply && git commit"
  echo ""
  exit 1
fi

exit 0
